{{- $u := urls.Parse (.Get "src") -}}
{{- $src := $u.String -}}
{{- if not $u.IsAbs -}}
  {{- with or (.Page.Resources.Get $u.Path) (resources.Get $u.Path) -}}
    {{- $src = .RelPermalink -}}
  {{- end -}}
{{- end -}}

<a href="{{ $src }}">
  <img src="{{ $src }}" alt="{{ .Get "alt" }}" style="{{ .Get "style" }}" class="{{ .Get "class" }}" />
</a>